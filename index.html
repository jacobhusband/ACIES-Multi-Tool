<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Projects</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css" />
</head>

<body>
    <header class="app-header">
        <div class="brand">
            <img src="./acies.png" alt="ACIES" class="logo-img" onerror="this.style.display='none'" />
        </div>
        <!-- Centered navigation -->
        <div class="header-center">
            <nav class="main-nav">
                <button class="main-tab-btn active" data-tab="projects">Projects</button>
                <button class="main-tab-btn" data-tab="notes">Notes</button>
                <button class="main-tab-btn" data-tab="tools">Tools</button>
                <button class="main-tab-btn" data-tab="plugins">Plugins</button>
            </nav>
        </div>
        <div class="header-actions">
            <button class="icon-btn" id="settingsBtn" aria-label="Settings" title="Settings">‚öôÔ∏è</button>
        </div>
    </header>
    <main>
        <!-- Tab Panel for Projects -->
        <div id="projects-panel" class="tab-panel active">
            <section class="panel stack">
                <div class="panel-toolbar">
                    <div class="nav-search expanded-search">
                        <svg class="search-icon" width="16" height="16" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="11" cy="11" r="8"></circle>
                            <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                        </svg>
                        <input id="search" type="search" placeholder="Search projects..." />
                    </div>
                    <div class="toolbar-actions">
                        <button class="icon-btn quick-add" id="quickNew" aria-label="New project"
                            title="New project">Ôºã</button>
                        <button class="icon-btn" id="aiBtn" aria-label="AI Project"
                            title="Create project with AI">ü§ñ</button>
                        <button class="icon-btn" id="statsBtn" aria-label="Statistics"
                            title="View Statistics">üìä</button>
                    </div>
                </div>
                <div class="filter-controls">
                    <div class="filter-label">Timeframe</div>
                    <div class="due-filter-group" id="dueFilterGroup">
                        <button class="filter-chip active" data-due-filter="all">All</button>
                        <button class="filter-chip" data-due-filter="past">Past Weeks</button>
                        <button class="filter-chip" data-due-filter="soon">This Week</button>
                        <button class="filter-chip" data-due-filter="future">Upcoming Weeks</button>
                    </div>
                    <div class="filter-label" style="margin-top:0.5rem">Status</div>
                    <div class="status-filter-group" id="statusFilterGroup">
                        <button class="filter-chip active" data-filter="all">All</button>
                        <button class="filter-chip" data-filter="incomplete">Incomplete</button>
                        <button class="filter-chip" data-filter="Pending Review">Pending Review</button>
                        <button class="filter-chip" data-filter="Complete">Complete</button>
                        <button class="filter-chip" data-filter="Waiting">Waiting</button>
                    </div>
                </div>
                <table class="table">
                    <thead>
                        <tr>
                            <th style="width:90px" data-sort="id">ID</th>
                            <th data-sort="name">Project Details</th>
                            <th style="width:120px" data-sort="due">Due</th>
                            <th style="width:150px">Status</th>
                            <th>Tasks</th>
                            <th class="nowrap" style="width:120px;text-align:center">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="tbody"></tbody>
                </table>
                <div id="emptyState" class="empty" style="display:none">
                    <div class="empty-icon">üìÇ</div>
                    <h3>No projects yet</h3>
                    <p>Create a new project to get started.</p>
                </div>
            </section>
        </div>
        <!-- Tab Panel for Notes -->
        <div id="notes-panel" class="tab-panel" hidden>
            <div class="panel stack full-height">
                <div class="panel-toolbar">
                    <div class="nav-search expanded-search">
                        <svg class="search-icon" width="16" height="16" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="11" cy="11" r="8"></circle>
                            <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                        </svg>
                        <input id="notesSearch" type="search" placeholder="Search notes..." />
                    </div>
                </div>
                <div class="notes-controls">
                    <h3 class="section-title">Custom Notes</h3>
                    <div class="notes-user-tabs-row">
                        <nav class="inner-tabs" id="notesTabsContainer"></nav>
                        <!-- Add/Remove buttons moved inside inner-tabs via JS -->
                    </div>
                </div>
                <div class="inner-tab-content">
                    <textarea id="notesTextarea" class="notes-textarea"
                        placeholder="Select a page to start writing notes..."></textarea>
                </div>
                <!-- Search Results Container -->
                <div id="notesSearchResults" class="notes-search-results"></div>
            </div>
        </div>
        <!-- Tab Panel for Tools -->
        <div id="tools-panel" class="tab-panel" hidden>
            <section class="panel stack">
                <!-- Combined Header -->
                <div class="autocad-tools-header"
                    style="display: flex; justify-content: space-between; align-items: flex-start;">
                    <div class="autocad-tools-section">
                        <h3 class="section-title">AutoCAD Tools</h3>
                        <p class="tiny muted">Run scripts to automate common AutoCAD tasks.</p>
                    </div>
                    <button id="abortBtn" class="btn btn-danger" style="display: none;">‚èπ Abort Process</button>
                </div>

                <div class="tools-grid">
                    <!-- Card 1: Publish DWGs -->
                    <div id="toolPublishDwgs" class="tool-card" role="button" tabindex="0">
                        <div class="tool-card-content">
                            <div class="tool-icon">üñ®Ô∏è</div>
                            <div class="tool-card-header">Publish CAD DWGs in Headless Mode</div>
                            <div class="tool-card-body">
                                Plots the layouts of each of the selected DWG files and combines them. Outputs to
                                local path "user/document/AutoCAD Plots". Opens output folder with plotted PDFs.
                            </div>
                        </div>
                        <div class="tool-card-status"></div>
                    </div>
                    <!-- Card 2: Clean XREFs -->
                    <div id="toolCleanXrefs" class="tool-card" role="button" tabindex="0">
                        <div class="tool-card-content">
                            <div class="tool-icon">üßπ</div>
                            <div class="tool-card-header">Prepare CAD DWG for Reference</div>
                            <div class="tool-card-body">
                                Strips saved XREF paths. Sets all objects color to "by layer". Purges & Audits.
                            </div>
                        </div>
                        <div class="tool-card-status"></div>
                    </div>
                    <!-- Card 3: Clean DWGs -->
                    <div id="toolCleanDwgs" class="tool-card" role="button" tabindex="0">
                        <div class="tool-card-content">
                            <div class="tool-icon">‚ú®</div>
                            <div class="tool-card-header">Prepare CAD DWG for Export</div>
                            <div class="tool-card-body">
                                Duplicates files to temp location. Cleans the titleblock. Cleans the drawings.
                                Saves the drawings as layout names. Opens temp folder with clean drawings.
                            </div>
                        </div>
                        <div class="tool-card-status"></div>
                    </div>
                </div>
            </section>
        </div>
        <!-- Tab Panel for Plugins -->
        <div id="plugins-panel" class="tab-panel" hidden>
            <section class="panel stack">
                <!-- Unified Commands Section -->
                <div class="commands-section">
                    <h3 class="section-title">AutoCAD Plugins</h3>
                    <p class="tiny muted">Install, update, or uninstall command bundles.</p>
                    <div id="commands-container" class="tools-grid">
                        <!-- Command cards will be dynamically inserted here -->
                        <div class="spinner">Loading commands...</div>
                    </div>
                </div>
            </section>
        </div>
    </main>
    <!-- Edit / New Modal -->
    <dialog id="editDlg">
        <div class="modal-header">
            <div id="dlgTitle" class="title">Edit Project</div>
            <div class="inline">
                <button class="btn ghost" onclick="closeDlg('editDlg')">Cancel</button>
                <button class="btn-primary" id="btnSaveProject">Save Changes</button>
            </div>
        </div>
        <div class="modal-body stack">
            <div class="modal-grid">
                <div class="col-4">
                    <label class="label">Project ID</label>
                    <input id="f_id" placeholder="e.g. 250410" />
                </div>
                <div class="col-8">
                    <label class="label">Project Name</label>
                    <input id="f_name" placeholder="BofA, 121 Windward Ave., Venice, CA" />
                </div>
                <div class="col-4">
                    <label class="label">Nickname</label>
                    <input id="f_nick" placeholder="optional" />
                </div>
                <div class="col-4">
                    <label class="label">Due Date</label>
                    <input id="f_due" placeholder="MM/DD/YY" />
                </div>
                <div class="col-4">
                    <label class="label">Project Path</label>
                    <input id="f_path" placeholder="e.g. M:\Projects\..." />
                </div>
                <div class="col-12">
                    <label class="label">Status</label>
                    <div id="f_statuses" class="status-picker">
                        <button type="button" class="st st-pr" data-status="Pending Review" aria-pressed="false"
                            title="Pending Review">Pending Review</button>
                        <button type="button" class="st st-comp" data-status="Complete" aria-pressed="false"
                            title="Complete">Complete</button>
                        <button type="button" class="st st-wait" data-status="Waiting" aria-pressed="false"
                            title="Waiting">Waiting</button>
                    </div>
                </div>
                <div class="col-12">
                    <label class="label">Notes</label>
                    <textarea id="f_notes" rows="3" placeholder="Freeform notes‚Ä¶"></textarea>
                </div>
            </div>
            <div class="section-divider"></div>
            <div class="stack">
                <div class="inline" style="justify-content:space-between">
                    <div class="title section-header">Tasks</div>
                    <button class="btn-accent tiny" onclick="addTaskRow()">Ôºã Add Task</button>
                </div>
                <div id="taskList" class="stack"></div>
            </div>
            <div class="section-divider"></div>
            <div class="stack">
                <div class="inline" style="justify-content:space-between">
                    <div class="title section-header">Reference Links</div>
                    <button class="btn-accent tiny" onclick="addRefRow()">Ôºã Add Link</button>
                </div>
                <div id="refList" class="stack"></div>
            </div>
        </div>
    </dialog>
    <!-- Email Modal -->
    <dialog id="emailDlg">
        <div class="modal-header">
            <div class="title">Create from Email</div>
            <div class="inline">
                <button class="btn ghost" onclick="closeDlg('emailDlg')">Cancel</button>
                <button class="btn-primary" id="btnProcessEmail">Process with AI</button>
            </div>
        </div>
        <div class="modal-body stack">
            <p class="tiny muted">Paste the full email content below. The AI will extract the project details.</p>
            <textarea id="emailArea" rows="15" placeholder="Paste email content here‚Ä¶"></textarea>
            <div id="aiSpinner" class="spinner" style="display:none;">Processing with AI...</div>
        </div>
    </dialog>
    <!-- Paste CSV Modal -->
    <dialog id="pasteDlg">
        <div class="modal-header">
            <div class="title">Paste CSV</div>
            <div class="inline">
                <button class="btn ghost" onclick="closeDlg('pasteDlg')">Close</button>
                <button class="btn-primary" id="btnPasteImport">Import</button>
            </div>
        </div>
        <div class="modal-body stack">
            <div class="tiny muted">Expected columns: <b>ID, Project Name, Nickname, Notes, Due Date, Status, Tasks,
                    Path, Reference1, Reference2, ‚Ä¶</b></div>
            <textarea id="pasteArea" rows="12" placeholder="Paste rows from Excel/CSV here‚Ä¶"></textarea>
            <label class="inline tiny checkbox-label"><input type="checkbox" id="hasHeader" checked style="width:auto">
                First row
                contains headers</label>
        </div>
    </dialog>
    <!-- Delete All Confirmation Modal -->
    <dialog id="deleteDlg" class="danger-modal">
        <div class="modal-body stack centered-content">
            <div class="danger-icon-large">‚ö†Ô∏è</div>
            <h2 class="danger-heading">Delete All Projects?</h2>
            <p class="muted">This action is irreversible. All project data will be permanently lost.</p>

            <div class="confirmation-box">
                <label class="label" style="text-align:center">Type <b>DELETE</b> to confirm</label>
                <input id="deleteConfirmInput" type="text" placeholder="DELETE" autocomplete="off"
                    class="danger-input" />
            </div>

            <div class="modal-footer-simple">
                <button class="btn ghost" onclick="closeDlg('deleteDlg')">Cancel</button>
                <button class="btn-danger" id="btnDeleteConfirm" disabled>Delete All Data</button>
            </div>
        </div>
    </dialog>
    <!-- Mark Overdue Confirmation Modal -->
    <dialog id="markOverdueDlg">
        <div class="modal-header">
            <div class="title">Mark Past Due Projects as Complete</div>
            <button class="btn ghost" onclick="closeDlg('markOverdueDlg')">Cancel</button>
        </div>
        <div class="modal-body stack">
            <p>This will change the status of all projects with a due date before today to "Complete".</p>
            <p>Are you sure you want to proceed?</p>
            <div class="inline" style="justify-content: flex-end; gap: 1rem;">
                <button class="btn ghost" onclick="closeDlg('markOverdueDlg')">Cancel</button>
                <button class="btn-primary" id="btnConfirmMarkOverdue">Yes, Mark as Complete</button>
            </div>
        </div>
    </dialog>
    <!-- Delete All Notes Confirmation Modal -->
    <dialog id="deleteNotesDlg" class="danger-modal">
        <div class="modal-body stack centered-content">
            <div class="danger-icon-large">‚ö†Ô∏è</div>
            <h2 class="danger-heading">Delete All Notes?</h2>
            <p class="muted">This will delete all stored notes and custom pages. This cannot be undone.</p>

            <div class="confirmation-box">
                <label class="label" style="text-align:center">Type <b>DELETE</b> to confirm</label>
                <input id="deleteNotesConfirmInput" type="text" placeholder="DELETE" autocomplete="off"
                    class="danger-input" />
            </div>

            <div class="modal-footer-simple">
                <button class="btn ghost" onclick="closeDlg('deleteNotesDlg')">Cancel</button>
                <button class="btn-danger" id="btnDeleteNotesConfirm" disabled>Delete All Notes</button>
            </div>
        </div>
    </dialog>
    <!-- Uninstall All Plugins Confirmation Modal -->
    <dialog id="uninstallPluginsDlg" class="danger-modal">
        <div class="modal-body stack centered-content">
            <div class="danger-icon-large">‚ö†Ô∏è</div>
            <h2 class="danger-heading">Uninstall All Plugins?</h2>
            <p class="muted">This will remove all installed AutoCAD plugins from your system.</p>

            <div class="confirmation-box">
                <label class="label" style="text-align:center">Type <b>UNINSTALL</b> to confirm</label>
                <input id="uninstallPluginsConfirmInput" type="text" placeholder="UNINSTALL" autocomplete="off"
                    class="danger-input" />
            </div>

            <div class="modal-footer-simple">
                <button class="btn ghost" onclick="closeDlg('uninstallPluginsDlg')">Cancel</button>
                <button class="btn-danger" id="btnUninstallPluginsConfirm" disabled>Uninstall All</button>
            </div>
        </div>
    </dialog>
    <!-- Settings Modal -->
    <dialog id="settingsDlg">
        <div class="modal-header">
            <div class="title">Settings</div>
            <button class="btn ghost" onclick="closeDlg('settingsDlg')">Close</button>
        </div>
        <div class="modal-body stack">
            <!-- General Section -->
            <h3 class="section-title">General</h3>
            <div class="modal-grid">
                <div class="col-6">
                    <label class="label">Full Name</label>
                    <input id="settings_userName" placeholder="e.g. Jacob Husband" />
                </div>
                <div class="col-6">
                    <label class="label">Discipline</label>
                    <div id="settings_discipline" class="inline radio-group" style="height: 38px; align-items: center;">
                        <label class="radio-label"><input type="radio" name="settings_discipline_radio"
                                value="Electrical"> Electrical</label>
                        <label class="radio-label"><input type="radio" name="settings_discipline_radio"
                                value="Mechanical"> Mechanical</label>
                        <label class="radio-label"><input type="radio" name="settings_discipline_radio"
                                value="Plumbing"> Plumbing</label>
                    </div>
                </div>
            </div>

            <!-- Integrations Section -->
            <h3 class="section-title" style="margin-top: 1rem;">Integrations</h3>
            <div class="modal-grid">
                <div class="col-12">
                    <label class="label">Google Gemini API Key</label>
                    <div class="input-with-button">
                        <input id="settings_apiKey" type="password" placeholder="Enter your API key" />
                        <button type="button" class="btn tiny" id="settings_howToSetupBtn">Help</button>
                    </div>
                </div>
            </div>

            <!-- AutoCAD Version Section -->
            <h3 class="section-title" style="margin-top: 1rem;">AutoCAD Version</h3>
            <div class="modal-grid">
                <div class="col-12">
                    <label class="label">Select Preferred AutoCAD Version</label>
                    <div id="autocad_versions_container" class="radio-group" style="flex-wrap: wrap;">
                        <!-- Detected versions will be inserted here -->
                    </div>
                    <div class="input-with-button" style="margin-top: 0.5rem;">
                        <input id="settings_autocadPath" placeholder="Custom AutoCAD executable path..." readonly />
                        <button class="btn tiny" id="btnBrowseAutocad">Browse...</button>
                    </div>
                </div>
            </div>

            <!-- Actions Section -->
            <h3 class="section-title" style="margin-top: 1rem;">Actions</h3>
            <div class="stack">
                <div class="setting-row">
                    <div class="setting-info">
                        <div class="setting-label">Mark Overdue as Complete</div>
                        <div class="setting-desc">Change status of all past due projects to "Complete"</div>
                    </div>
                    <button class="btn" id="btnMarkOverdue">Run Action</button>
                </div>
            </div>

            <!-- Danger Zone -->
            <div class="danger-zone">
                <h3 class="danger-title">Danger Zone</h3>

                <div class="danger-row">
                    <div class="danger-info">
                        <div class="danger-label">Delete All Projects</div>
                        <div class="danger-desc">Permanently remove all project data. This cannot be undone.</div>
                    </div>
                    <button class="btn btn-danger" id="btnDeleteAll">Delete Projects</button>
                </div>

                <div class="danger-divider"></div>

                <div class="danger-row">
                    <div class="danger-info">
                        <div class="danger-label">Delete All Notes</div>
                        <div class="danger-desc">Permanently remove all notes and pages.</div>
                    </div>
                    <button class="btn btn-danger" id="btnDeleteAllNotes">Delete Notes</button>
                </div>

                <div class="danger-divider"></div>

                <div class="danger-row">
                    <div class="danger-info">
                        <div class="danger-label">Uninstall Plugins</div>
                        <div class="danger-desc">Remove all installed AutoCAD plugins.</div>
                    </div>
                    <button class="btn btn-danger" id="btnUninstallAllPlugins">Uninstall Plugins</button>
                </div>
            </div>

            <p class="tiny muted" style="margin-top: 1rem;">Settings are saved automatically.</p>
        </div>
    </dialog>
    <!-- AutoCAD Selection Modal -->
    <dialog id="autocadSelectDlg">
        <div class="modal-header">
            <div class="title">Select AutoCAD Version</div>
            <button class="btn ghost" onclick="closeDlg('autocadSelectDlg')">Cancel</button>
        </div>
        <div class="modal-body stack">
            <p class="tiny muted">Please select your preferred AutoCAD version to use with the tools.</p>
            <div class="modal-grid">
                <div class="col-12">
                    <label class="label">Detected Versions</label>
                    <div id="autocad_select_container" class="radio-group" style="flex-wrap: wrap;">
                        <!-- Detected versions will be inserted here -->
                    </div>
                    <div class="input-with-button" style="margin-top: 0.5rem;">
                        <input id="autocad_select_custom" placeholder="Custom AutoCAD executable path..." readonly />
                        <button class="btn tiny" id="btnBrowseAutocadSelect">Browse...</button>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-primary" id="btnSaveAutocadSelect">Save Selection</button>
            </div>
        </div>
    </dialog>
    <!-- Statistics Modal -->
    <dialog id="statsDlg">
        <div class="modal-header">
            <div class="title">Project Statistics</div>
            <button class="btn ghost" onclick="closeDlg('statsDlg')">Close</button>
        </div>
        <div class="modal-body stack">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="statTotal">0</div>
                    <div class="stat-label">Total Projects</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="statCompleted">0</div>
                    <div class="stat-label">Completed</div>
                </div>

                <div class="stat-card">
                    <div class="stat-value" id="statAvg">0</div>
                    <div class="stat-label">Avg. Projects / Week</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="statAvgMonth">0</div>
                    <div class="stat-label">Avg. Projects / Month</div>
                </div>

                <div class="stat-card">
                    <div class="stat-value" id="statLastWeek">0</div>
                    <div class="stat-label">Due Last Week</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="statThisWeek">0</div>
                    <div class="stat-label">Due This Week</div>
                </div>

                <div class="stat-card">
                    <div class="stat-value" id="statCompletedLastYear">0</div>
                    <div class="stat-label">Completed Last Year</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="statCompletedThisYear">0</div>
                    <div class="stat-label">Completed This Year</div>
                </div>

                <div class="stat-card full-width">
                    <div class="stat-value" id="statUpcoming">0</div>
                    <div class="stat-label">Upcoming (Future)</div>
                </div>
            </div>
        </div>
    </dialog>
    <!-- API Key Help Modal -->
    <dialog id="apiKeyHelpDlg">
        <div class="modal-header">
            <div class="title">Setup API Key</div>
            <button class="btn ghost" onclick="closeDlg('apiKeyHelpDlg')">Close</button>
        </div>
        <div class="modal-body stack">
            <p>To use the AI features, you need a free API key from Google AI Studio.</p>
            <ol style="margin: 0; padding-left: 1.25rem; line-height: 1.6;">
                <li>Click the button below to open Google AI Studio.</li>
                <li>Log in with your Google account.</li>
                <li>Click "<b>Create API key in new project</b>".</li>
                <li>Copy the generated key.</li>
                <li>Paste the key into the Settings menu in this app.</li>
            </ol>
            <a href="https://aistudio.google.com/api-keys" target="_blank" class="btn-primary block-center">Open Google
                AI Studio</a>
        </div>
    </dialog>
    <!-- Clean DWGs Modal -->
    <dialog id="cleanDwgsDlg">
        <div class="modal-header">
            <div class="title">Clean DWGs Tool</div>
            <button class="btn ghost" onclick="closeDlg('cleanDwgsDlg')">Cancel</button>
        </div>
        <div class="modal-body stack">
            <p class="tiny muted">Select a titleblock. The parent folder (typically "Xrefs") is automatically included.
            </p>

            <div class="modal-grid">
                <div class="col-12">
                    <label class="label">1. Select Titleblock DWG</label>
                    <div class="input-with-button">
                        <input id="cleanDwgs_titleblockPath" placeholder="No titleblock selected..." readonly />
                        <button class="btn tiny" id="btnSelectTitleblock">Browse...</button>
                    </div>
                </div>

                <div class="col-12">
                    <label class="label">2. Additional Disciplines</label>
                    <div id="cleanDwgs_disciplines" class="inline radio-group" style="flex-wrap: wrap;">
                        <label class="radio-label"><input type="checkbox" name="cleanDwgs_discipline"
                                value="Electrical"> Electrical</label>
                        <label class="radio-label"><input type="checkbox" name="cleanDwgs_discipline"
                                value="Mechanical"> Mechanical</label>
                        <label class="radio-label"><input type="checkbox" name="cleanDwgs_discipline" value="Plumbing">
                            Plumbing</label>
                    </div>
                </div>
            </div>

            <div class="modal-footer">
                <button class="btn-primary" id="btnProceedCleanDwgs">‚ñ∂ Run Tool</button>
            </div>
        </div>
    </dialog>
    <!-- Command Details Modal -->
    <dialog id="commandDetailsDlg">
        <div class="modal-header">
            <div id="detailsTitle" class="title">Command Details</div>
            <button class="btn ghost" onclick="closeDlg('commandDetailsDlg')">Close</button>
        </div>
        <div class="modal-body stack">
            <div id="detailsVideo" class="video-container"></div>
            <div id="detailsCommands" class="stack"></div>
        </div>
    </dialog>
    <!-- Install Prerequisite Modal -->
    <dialog id="installPrereqDlg">
        <div class="modal-header">
            <div id="installPrereqTitle" class="title">Installation Required</div>
            <button class="btn ghost" onclick="closeDlg('installPrereqDlg')">Cancel</button>
        </div>
        <div class="modal-body stack">
            <p id="installPrereqMessage">To use this tool, the "CleanCADCommands" bundle needs to be installed.</p>
            <div id="installSpinner" class="spinner" style="display:none;">Installing...</div>
        </div>
        <div class="modal-footer">
            <button class="btn" onclick="closeDlg('installPrereqDlg')">Later</button>
            <button class="btn-primary" id="btnInstallPrereq">Install Now</button>
        </div>
    </dialog>

    <!-- HTML Templates for JS rendering -->
    <template id="project-row-template">
        <tr class="row">
            <td class="cell-id"><span class="id-badge"></span></td>
            <td class="cell-name"></td>
            <td class="cell-due"></td>
            <td class="cell-status"></td>
            <td class="cell-tasks"></td>
            <td class="cell-actions actions"></td>
        </tr>
    </template>
    <template id="task-row-template">
        <div class="task-row modal-grid" style="align-items:center">
            <div class="col-8"><input class="t-text" placeholder="Task description"></div>
            <div class="col-1"><label class="tiny inline checkbox-label"><input type="checkbox" class="t-done"
                        style="width:auto">
                    Done</label></div>
            <div class="col-3 inline" style="justify-content:flex-end; gap:.4rem"><button type="button"
                    class="btn tiny btn-remove text-danger">Remove</button></div>
            <div class="col-6"><input class="t-link" placeholder="Optional link or file path"></div>
            <div class="col-6"><input class="t-link2" placeholder="Second link (optional)"></div>
        </div>
    </template>
    <template id="ref-row-template">
        <div class="ref-row modal-grid" style="align-items:center">
            <div class="col-4"><input class="r-label" placeholder="Label (optional)"></div>
            <div class="col-8"><input class="r-url" placeholder="URL or file path"></div>
            <div class="col-12 inline" style="justify-content:flex-end; gap:.4rem"><button type="button"
                    class="btn tiny btn-remove text-danger">Remove</button></div>
        </div>
    </template>
    <script src="script.js"></script>
</body>

</html>